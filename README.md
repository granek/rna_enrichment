This repository contains the code for [Comparative analysis of RNA enrichment methods for preparation of Cryptococcus neoformans RNA sequencing libraries](https://doi.org/10.1101/2021.03.01.433483). Instructions for reproducing the analysis described in the manuscript are below.

# Full Analysis, except lncRNA discovery
To run the full analysis in the manuscript (except lncRNA discovery):

  1. Clone this repository
  2. Run the script `run_full_analysis.sh`, which is found in top level of this repository
  
The `run_full_analysis.sh` script will download the singularity image from Sylabs Cloud, download the raw sequence data from SRA, and run all the components of the analysis.
  
## Requirements
  1. [Singularity](https://sylabs.io/guides/3.7/user-guide/). It is known to work with Singularity version 3.6.4, but probably works fine with version 3.0 and above
  2. Bash
  3. Create the directories specified by `DATA_BASE_DIR`, `WORKSPACE_BASE_DIR` and `SPACE_DIR` (see below)
  
## Recommended Configuration
It is recommended that you make the configuration adjustments

1. Check the values in the `common_config.R` for these variables and adjust appropriately for the machine you will be running on:
    - `total_threads` should be less than the total number of cores you have available
    - `max_jobs` can be 1 or higher, ideally should be a factor of total_threads
    - `max_memory_mb` should be less than the total memory you have available
2. Set values for the following environment variables in your .bashrc, when running `run_full_analysis.sh`, or by editing `setup.sh`:
    - `DATA_BASE_DIR`: where raw data will be downloaded 
    - `WORKSPACE_BASE_DIR`: where intermediate results and final results will be output
    - `SPACE_DIR` : directory used by lncRNA 
    - `SINGULARITY_CACHEDIR` described in the [Singularity User Manual](https://sylabs.io/guides/2.6/user-guide/build_environment.html#cache)
    - `SINGULARITY_PULLFOLDER` described in the [Singularity User Manual](https://sylabs.io/guides/2.6/user-guide/build_environment.html#cache)


## Running on a cluster
This script can be run on a SLURM cluster with the following command
```
srun ./run_full_analysis.sh
```

However a slightly more complex command might be desireable, which specifies the partition, account, number of CPUs and amount of memory to allocate, such as:

```
srun -A chsi -p chsi --cpus-per-task=60 --mem=300G ./run_full_analysis.sh
```


<!-- 
Describe where to find output
 --> 


<!-- 
# lncRNA Discovery

To run the lncRNA discovery analysis:

  0. Download the FASTQS: run ?????????? (already done above in)  
  1. Setup for lncRNA discovery analysis: knit `lnc_rna/run_lncpipe_reproducible.Rmd` with the following command in the top level of this repository
```
singularity exec --bind /space:/space library://granek/published/rna_enrichment:latest Rscript -e "rmarkdown::render('lnc_rna/run_lncpipe_reproducible.Rmd')"
```
  2. `Run`cd` into the working directory generated by the above setup script and run `bash lncpipe_prep.sh`
  
 --> 
